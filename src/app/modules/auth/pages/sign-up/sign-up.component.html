<div class="w-full max-w-md mx-auto">
  <!-- Progress Indicator -->
  <div class="mb-6 sm:mb-8">
    <div class="flex items-center justify-between mb-2">
      <div *ngFor="let step of steps; let i = index" class="flex items-center">
        <div class="w-6 h-6 sm:w-8 sm:h-8 rounded-full flex items-center justify-center text-xs font-medium"
             [ngClass]="currentStep >= i ? 'bg-primary text-primary-foreground' : 'bg-muted text-muted-foreground'">
          {{ i + 1 }}
        </div>
        <div *ngIf="i < steps.length - 1" class="w-8 sm:w-12 h-1 mx-1"
             [ngClass]="currentStep > i ? 'bg-primary' : 'bg-muted'"></div>
      </div>
    </div>
    <div class="text-center text-xs sm:text-sm text-muted-foreground">
      {{ 'signup.steps.' + currentStep + '.title' | translate }}
    </div>
  </div>

  <form [formGroup]="signUpForm" (ngSubmit)="onSubmit()" class="bg-card rounded-xl sm:rounded-2xl shadow-lg p-4 sm:p-6">

    <!-- Step 1: Personal Info -->
    <div *ngIf="currentStep === 0" class="space-y-4 sm:space-y-5 animate-fade-in">
      <div class="text-center mb-4 sm:mb-6">
        <h2 class="text-xl sm:text-2xl font-bold text-primary">{{ 'signup.personal.heading' | translate }}</h2>
        <p class="text-muted-foreground text-sm mt-1">{{ 'signup.personal.subheading' | translate }}</p>
      </div>

      <div>
        <label class="block text-sm font-medium text-foreground mb-1.5">
          {{ 'signup.personal.fullName' | translate }}
        </label>
        <input type="text" formControlName="fullName" placeholder="John Doe" class="input" />
      </div>

      <div>
        <label class="block text-sm font-medium text-foreground mb-1.5">
          {{ 'signup.personal.dob' | translate }}
        </label>
        <input type="date" formControlName="dateOfBirth" class="input" />
      </div>

      <div>
        <label class="block text-sm font-medium text-foreground mb-1.5">
          {{ 'signup.personal.email' | translate }}
        </label>
        <input type="email" formControlName="email" placeholder="you@example.com" class="input" />
      </div>

      <div>
        <label class="block text-sm font-medium text-foreground mb-1.5">
          {{ 'signup.personal.password' | translate }}
        </label>
        <div class="relative">
          <input [type]="showPassword ? 'text' : 'password'" formControlName="password"
                 [placeholder]="'signup.personal.passwordPlaceholder' | translate"
                 class="input" />
          <button type="button" (click)="togglePassword()" class="password-toggle">
            <svg-icon [src]="showPassword ? 'assets/icons/heroicons/outline/eye.svg' : 'assets/icons/heroicons/outline/eye-off.svg'"></svg-icon>
          </button>
        </div>
      </div>
    </div>

    <!-- Step 2: Identification -->
    <div *ngIf="currentStep === 1" class="space-y-4 sm:space-y-5 animate-fade-in">
      <div class="text-center mb-4 sm:mb-6">
        <h2 class="text-xl sm:text-2xl font-bold text-primary">{{ 'signup.identification.heading' | translate }}</h2>
        <p class="text-muted-foreground text-sm mt-1">{{ 'signup.identification.subheading' | translate }}</p>
      </div>

      <div>
        <label class="block text-sm font-medium text-foreground mb-1.5">
          {{ 'signup.identification.idType' | translate }}
        </label>
        <div class="grid grid-cols-2 gap-2 sm:gap-3">
          <label *ngFor="let idType of idTypes" class="radio-option"
                 [ngClass]="signUpForm.get('identificationType')?.value === idType.value ? 'selected' : 'hover:bg-muted/50'">
            <input type="radio" formControlName="identificationType" [value]="idType.value" class="sr-only" />
            <span>{{ idType.label }}</span>
          </label>
        </div>
      </div>

      <div>
        <label class="block text-sm font-medium text-foreground mb-1.5">
          {{ 'signup.identification.idNumber' | translate }}
        </label>
        <input type="text" formControlName="passportNumber" placeholder="Enter your ID number" class="input" />
      </div>

      <div>
        <label class="block text-sm font-medium text-foreground mb-1.5">
          {{ 'signup.identification.expiryDate' | translate }}
        </label>
        <input type="date" formControlName="passportExpiryDate" class="input" />
      </div>

      <div>
        <label class="block text-sm font-medium text-foreground mb-1.5">
          {{ 'signup.identification.nationality' | translate }}
        </label>
        <input type="text" formControlName="nationality" placeholder="e.g. American" class="input" />
      </div>

      <div>
        <label class="block text-sm font-medium text-foreground mb-1.5">
          {{ 'signup.identification.gender' | translate }}
        </label>
        <div class="grid grid-cols-3 gap-2">
          <label *ngFor="let gender of genders" class="radio-option"
                 [ngClass]="signUpForm.get('gender')?.value === gender.value ? 'selected' : 'hover:bg-muted/50'">
            <input type="radio" formControlName="gender" [value]="gender.value" class="sr-only" />
            <span>{{ gender.label }}</span>
          </label>
        </div>
      </div>
    </div>

    <!-- Step 3: Final Step -->
    <div *ngIf="currentStep === 2" class="space-y-4 sm:space-y-5 animate-fade-in">
      <div class="text-center mb-4 sm:mb-6">
        <h2 class="text-xl sm:text-2xl font-bold text-primary">{{ 'signup.final.heading' | translate }}</h2>
        <p class="text-muted-foreground text-sm mt-1">{{ 'signup.final.subheading' | translate }}</p>
      </div>

      <div class="upload-box">
        <svg-icon src="assets/icons/heroicons/outline/document-text.svg"></svg-icon>
        <p>{{ 'signup.final.uploadTitle' | translate }}</p>
        <p>{{ 'signup.final.uploadNote' | translate }}</p>
        <label class="upload-btn">
          {{ 'signup.final.chooseFile' | translate }}
          <input type="file" (change)="onFileChange($event)" class="hidden" />
        </label>
        <div *ngIf="uploadedFileName" class="mt-3 sm:mt-4 text-sm text-foreground">
          Selected: {{ uploadedFileName }}
        </div>
      </div>

      <div class="flex items-start gap-3 mt-4 sm:mt-6">
        <input type="checkbox" formControlName="acceptTerms" id="acceptTerms" class="checkbox" />
        <label for="acceptTerms" class="text-sm text-muted-foreground leading-relaxed">
          {{ 'signup.final.termsText' | translate }}
          <a href="#" class="text-primary hover:underline">{{ 'signup.final.termsLink' | translate }}</a> &amp;
          <a href="#" class="text-primary hover:underline">{{ 'signup.final.privacyLink' | translate }}</a>
        </label>
      </div>

      <div class="summary-box">
        <h3 class="font-medium text-foreground text-sm sm:text-base">
          {{ 'signup.final.summaryTitle' | translate }}
        </h3>
        <div class="flex justify-between">
          <span>{{ 'signup.final.summary.name' | translate }}</span>
          <span>{{ signUpForm.get('fullName')?.value || ('signup.generic.notProvided' | translate) }}</span>
        </div>
        <div class="flex justify-between">
          <span>{{ 'signup.final.summary.email' | translate }}</span>
          <span>{{ signUpForm.get('email')?.value || ('signup.generic.notProvided' | translate) }}</span>
        </div>
        <div class="flex justify-between">
          <span>{{ 'signup.final.summary.idType' | translate }}</span>
          <span>{{ signUpForm.get('identificationType')?.value || ('signup.generic.notProvided' | translate) }}</span>
        </div>
      </div>
    </div>

    <!-- Navigation -->
    <div class="flex justify-between mt-6 sm:mt-8 gap-3">
      <button type="button" *ngIf="currentStep > 0" (click)="previousStep()" class="btn-secondary">
        {{ 'signup.navigation.previous' | translate }}
      </button>

      <div *ngIf="currentStep === 0" class="flex-1"></div>

      <button type="button" *ngIf="currentStep < steps.length - 1" (click)="nextStep()" 
              [disabled]="!isCurrentStepValid()" class="btn-primary">
        {{ 'signup.navigation.next' | translate }}
      </button>

      <button type="submit" *ngIf="currentStep === steps.length - 1" 
              [disabled]="signUpForm.invalid" class="btn-primary">
        {{ 'signup.navigation.submit' | translate }}
      </button>
    </div>
  </form>

  <!-- Sign In Link -->
  <div class="text-center mt-4 sm:mt-6 text-sm text-muted-foreground">
    {{ 'signup.navigation.alreadyHaveAccount' | translate }}
    <a (click)="onNavigateToSignIn()" class="text-primary font-medium hover:underline touch-target">
      {{ 'signup.navigation.signin' | translate }}
    </a>
  </div>
</div>
